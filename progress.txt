# Ralph Progress Log
## Codebase Patterns
- `flowchart` lint includes `react-hooks/refs`; avoid `ref.current` reads during render-time initialization and use non-ref constants for initial state.
- `skills/qa-plan-generator/SKILL.md` uses mutually exclusive generation modes; when using free-text objectives, enforce one of the six objective types and deterministic output naming `test-plan-objective-<objective-type>-<slug>.md`.
- `skills/qa-plan-json/SKILL.md` should keep strict schema/versioning (`qaPlanSchemaVersion: 1.0.0`) and emit fail-fast validation messages with source-line references using `E-<code> [line <n>] ...` format.
- `qa-codex-loop.sh` is the QA execution entrypoint; it enforces `qaPlanSchemaVersion: 1.0.0`, executes tests in sorted `TC-###` order, and only marks PASS when tool exit is zero and output includes `<status>PASS</status>`.
- `qa-codex-loop.sh` remediation mode is bounded and deterministic: run a full gate first, then for each loop run patch attempt -> rerun failed tests -> rerun full gate, with stop controls (`maxLoops`, optional `maxDuration`, optional `maxPatchCount`) and terminal diagnostics in `summary.json` + `unresolved.json`.

Started: Fri Feb 27 08:44:00 UTC 2026
---
## 2026-02-27 08:46:26 UTC - US-001
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Implemented `skills/qa-plan-generator/SKILL.md` to generate deterministic test plans from PRD markdown input, including required section ordering, scenario mapping, and ambiguity/assumption recording.
- Files changed: `skills/qa-plan-generator/SKILL.md`, `flowchart/src/App.tsx`, `AGENTS.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations:**
  - The QA skill implementation pattern in this repo is documentation-first (`SKILL.md`) with explicit input contract, step flow, output convention, and checklist sections.
  - `flowchart` lint can fail due to `react-hooks/refs` even when build/typecheck pass; keep render-time initialization independent from refs.
  - When adding new skills, place them in `skills/<skill-name>/SKILL.md` and keep structure aligned with existing `skills/prd` and `skills/ralph`.
---
## 2026-02-27 08:48:56 UTC - US-002
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Extended `skills/qa-plan-generator/SKILL.md` to accept free-text testing objectives in addition to PRD input, with explicit mode selection and objective-type handling.
- Added objective-specific strategy templates for acceptance, bug, test-gap, flaky, refactor-for-testability, and performance planning modes.
- Enforced predictable objective-mode output naming via `test-plan-objective-<objective-type>-<slug>.md`.
- Files changed: `skills/qa-plan-generator/SKILL.md`, `AGENTS.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations:**
  - Keep `qa-plan-generator` deterministic across both inputs by making mode selection exclusive and explicit before scenario generation.
  - Objective-mode plans should still follow the same section order as PRD mode and append only objective-specific strategy details.
- Deterministic filenames for free-text inputs need both normalized objective type and a stable slug from objective text.
---
## 2026-02-27 08:51:42 UTC - US-003
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Added new converter skill at `skills/qa-plan-json/SKILL.md` that mirrors `skills/ralph` converter pattern with explicit conversion rules, ordering discipline, and strict validation expectations.
- Documented a versioned executable schema (`qaPlanSchemaVersion: 1.0.0`) covering deterministic test IDs, steps, commands, pass/fail criteria, retry rules, evidence fields, and source-to-JSON mapping.
- Defined actionable validation error contract with source line references and fix guidance for malformed/missing sections, invalid IDs/enums, and incomplete automated test commands.
- Files changed: `skills/qa-plan-json/SKILL.md`, `AGENTS.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations:**
  - QA converter outputs should remain stable by preserving Scenario Matrix row order and deterministic `TC-###` IDs when constructing JSON `tests`.
  - Validation should fail fast with explicit source line references to make downstream debugging and executor ingestion deterministic.
  - Keep handoff explicit: successful converter output path feeds directly into the loop executor skill.
---
## 2026-02-27 08:54:48 UTC - US-004
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Added `qa-codex-loop` execution skill documentation with explicit baseline reuse analysis from `ralph.sh` and a gap analysis for JSON-plan QA execution needs.
- Implemented `qa-codex-loop.sh` executor entrypoint supporting explicit `--tool codex|claude-code`, deterministic test ordering by `TC-###`, per-test result capture, aggregate run summary, and machine-readable gate status via `status.txt` (`PASS`/`FAIL`).
- Files changed: `skills/qa-codex-loop/SKILL.md`, `qa-codex-loop.sh`, `AGENTS.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations:**
  - QA gate semantics are strict in this repo: aggregate PASS requires every test result to be PASS, and test-level PASS requires both successful tool execution and explicit `<status>PASS</status>` output.
  - Keep QA run artifacts under `logs/qa-loop/<run-id>/` with both per-test and aggregate files to preserve deterministic debugging context.
  - Skill handoff for QA should remain linear: generator (`.md`) -> converter (`.json`) -> executor (`qa-codex-loop`).
---
## 2026-02-27 08:59:36 UTC - US-005
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- Implemented bounded self-healing in `qa-codex-loop.sh`: after initial full gate failures, the executor now runs remediation loops that perform diagnose/patch, rerun affected failed tests, then rerun the full gate.
- Added loop controls `--max-loops`, `--max-duration`, and `--max-patch-count`, plus terminal failure reporting with `stopReason`, unresolved failures, and last root causes in run artifacts.
- Updated `skills/qa-codex-loop/SKILL.md` to document the remediation contract, new CLI options, and additional artifacts (`attempts/`, `remediation/`, `unresolved.json`).
- Files changed: `qa-codex-loop.sh`, `skills/qa-codex-loop/SKILL.md`, `AGENTS.md`, `prd.json`, `progress.txt`.
- **Learnings for future iterations:**
  - Keep QA gate semantics tied to full-suite status; failed-test reruns are only an intermediate signal before required full-gate validation.
  - Persist remediation diagnostics in machine-readable files (`summary.json` + `unresolved.json`) so downstream loops can surface exact unresolved IDs and root causes.
  - Bound self-healing loops with explicit controls to avoid unbounded patch churn in autonomous execution.
---
